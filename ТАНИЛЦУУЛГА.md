# Амралтын цогцолборын захиалгын систем — Танилцуулга

## Ерөнхий мэдээлэл

**Амралтын цогцолборын захиалгын систем** нь жижиг дунд хэмжээний амралтын газар, resort-д зориулсан нэгдсэн веб платформ юм. Хэрэглэгчдэд байшин захиалах, ресторанд захиалга өгөх, байршил харах зэрэг үйлчилгээг олгодог. Админд нь байшин, захиалга, өдрийн үйл ажиллагаа, ресторан, channel manager зэргийг нэг дороос удирдах боломж олгодог.

---

## Технологийн стек

| Бүрэлдэхүүн | Технологи |
|-------------|-----------|
| **Frontend** | Next.js 16, React 19, TypeScript |
| **Стиль** | Tailwind CSS 4 |
| **Бэкенд / Өгөгдөл** | Firebase (Firestore, Authentication, Storage) |
| **Өдөр / Цаг** | date-fns |
| **Икон** | lucide-react |

---

## Хэрэглэгчийн эрх ба үүрэг

### 1. Зочны эрх (user)

- **Нүүр хуудас** — Байшингуудын жагсаалт, нүүр зураг, дэлгэрэнгүй мэдээлэл
- **Байшин сонгох** — Үнэ, хүний тоо, тав тух (Wi-Fi, агааржуулалт г.м), хямдрал харах
- **Захиалга өгөх** — Өдөр сонгох, төлбөрийн төрөл (бүрэн, хэсэгчлэн, бартер), утасны баталгаажуулалт (OTP)
- **Миний захиалгууд** — `/profile` — Өөрийн захиалгуудын төлөв, баталгаажсан/хүлээгдэж буй
- **Ресторан** — `/restaurant` — Меню харах, сагсанд нэмэх, байшин руу хүргүүлэх эсвэл өөрөө авах захиалга
- **Нэвтрэх / Бүртгүүлэх** — И-мэйл/нууц үг, утасны баталгаажуулалт

### 2. Админы эрх (admin)

Админ нь `/admin` самбар болон дараах хэсгүүдийг удирдана:

| Хэсэг | Зам | Үүрэг |
|-------|-----|-------|
| **Хянах самбар** | `/admin` | Нийт байшин, захиалга, ресторан захиалга, хэрэглэгчийн тоо, өдрийн үйл ажиллагааны товч |
| **Байшин удирдлага** | `/admin/houses` | Байшин нэмэх/засах/устгах, зураг, үнэ, багтаамж, тав тух, хямдрал, төлөв (clean/dirty/occupied/cleaning/maintenance) |
| **Тав тух (Amenities)** | `/admin/amenities` | Тав тухын төрөл, зураг, тоо хэмжээ удирдах |
| **Захиалга** | `/admin/bookings` | Захиалгуудыг харах, баталгаажуулах, цуцлах |
| **Шинэ захиалга** | `/admin/bookings/new` | Гараар захиалга үүсгэх (зочны нэр, утас, и-мэйл, төлбөрийн төрөл: бүрэн/хэсэгчлэн/бартер) |
| **Өдрийн үйл ажиллагаа** | `/admin/operations` | Ирэх/гэх өдрийн жагсаалт, байшны төлөв солих (цэвэр/бохир/цэвэрлэж байна/хүнтэй/засвартай), өдрийн тайлан Telegram-руу илгээх |
| **Ресторан — Меню** | `/admin/restaurant/menu` | Цэсний ангилал, хоолны зүйлс нэмэх/засах, үнэ, зураг, бэлэн эсэх |
| **Ресторан — Захиалга (Kitchen)** | `/admin/restaurant/orders` | Ресторан захиалгуудыг харах, төлөв шинэчлэх (pending → confirmed → preparing → ready → delivered) |
| **Channel Manager** | `/admin/channel-manager` | Буудлын цахим сувгийн (жишээ: Booking.com) холболт, өрөө/үнэ синк тохиргоо |
| **Хэрэглэгчид** | `/admin/users` | Бүртгэлтэй хэрэглэгчдийн жагсаалт |
| **Тохиргоо** | `/admin/settings` | Сайтын ерөнхий тохиргоо |

---

## Гол үйлдлүүд

### Захиалгын урсгал (хэрэглэгч)

1. Нүүр хуудсаас байшин сонгох → Дэлгэрэнгүй (`/houses/[id]`)
2. Өдөр сонгох, хүний тоо оруулах, төлбөрийн төрөл сонгох
3. Нэвтрэх эсвэл бүртгүүлэх (шаардлагатай бол)
4. Утасны дугаар оруулах, OTP-ээр баталгаажуулах
5. Захиалга илгээх → Админ баталгаажуулна

### Ресторан захиалгын урсгал

1. Ресторан хуудас (`/restaurant`) — Цэс, ангилал, хайлт
2. Сагсанд нэмэх, тоо ширхэг, тэмдэглэл
3. Төлбөр төлөх (`/restaurant/checkout`) — Хүргүүлэх (байшин сонгох) эсвэл өөрөө авах
4. Админ Kitchen (`/admin/restaurant/orders`) — Захиалгын төлөв шинэчлэх

### Өдрийн үйл ажиллагаа (админ)

- Өдөр сонгох → Ирэх (check-in), гэх (check-out) захиалгууд харагдана
- Байшин бүрийн төлөв: **Цэвэр**, **Бохир**, **Цэвэрлэж байна**, **Хүнтэй**, **Засвартай**
- Өдрийн тайлан — Telegram-руу илгээх (тохиргоонд botToken, chatId тохируулсан бол)

---

## Өгөгдлийн бүтэц (Firestore)

| Collection | Тайлбар |
|------------|---------|
| `users` | Хэрэглэгчийн профайл: email, нэр, утас, `role` (user/admin), `phoneVerified` |
| `accommodations` | Байшин: нэр, дугаар, үнэ, багтаамж, зураг, `amenities`, `status`, `discount`, `channelMappings` |
| `amenities` | Тав тух: нэр, зураг, тоо |
| `bookings` | Захиалга: `userId`/`guestDetails`, `houseId`, огноо, `totalPrice`, `status`, `paymentType`, `barterDescription` |
| `settings` / `general` | Тохиргоо: `map`, `contact`, `cover`, `branding`, `social`, `bookingControl`, `telegram`, `channelManager`, `restaurant` |
| `menu_categories` | Цэсний ангилал: нэр, `order`, `isActive` |
| `menu_items` | Хоолны зүйл: `categoryId`, нэр, үнэ, зураг, `isAvailable`, `tags` |
| `orders` | Ресторан захиалга: `userId`, `items`, `totalAmount`, `status`, `deliveryType`, `houseId` |

---

## Нэмэлт боломжууд

- **Утасны баталгаажуулалт (OTP)** — Захиалга өгөх, зарим тохиргоонд шаардлагатай
- **Хямдрал** — Байшин бүрт: үнэ, огноо, долоо хоногийн өдрүүд, шошго
- **Бартер** — Гараар захиалга үүсгэх үед `paymentType: 'barter'`, `barterDescription`
- **Channel Manager** — Booking.com гэх мэт сувгуудтай өрөө/үнэ синк (тохиргооноос)
- **Telegram** — Өдрийн тайлан, захиалгын мэдэгдэл (тохиргооноос)
- **Захиалга хориглох** — `bookingControl.isBlocked`, огноо, мэдэгдэх утас
- **Брендинг** — Сайтын нэр, лого, нүүр зургийн гарчиг, дэд гарчиг

---

## Файлын бүтэц (гол хэсгүүд)

```
src/
├── app/                    # Next.js хуудсууд
│   ├── page.tsx            # Нүүр
│   ├── houses/[id]/        # Байшны дэлгэрэнгүй
│   ├── profile/            # Хэрэглэгчийн захиалгууд
│   ├── login/              # Зочны нэвтрэх
│   ├── restaurant/         # Ресторан, checkout
│   └── admin/              # Админ: houses, bookings, operations, restaurant, channel-manager, users, settings
├── components/
│   ├── admin/              # QuickBookingModal, HouseForm, BookingDetailsModal, ...
│   ├── auth/               # LoginModal
│   ├── user/               # BookingModal, PhoneVerificationModal
│   ├── reviews/            # ReviewForm, ReviewList
│   └── ui/                 # Navbar, ConfirmationModal
├── contexts/               # AuthContext, CartContext
├── actions/                # channelManager, telegram
├── lib/                    # firebase, sms, telegram, utils
├── hooks/                  # useAmenities
└── types/                  # User, House, Booking, Order, MenuItem, ResortSettings, ...
```

---

## Ажиллуулах

```bash
npm install
npm run dev    # http://localhost:3000
```

Шаардлага: Node.js, Firebase төсөл (Auth, Firestore, Storage). Тохиргоо: `.env.local` (Firebase config), Firestore `settings/general`.

Админ болгох: Firestore `users` collection дотор тухайн хэрэглэгчийн `role`-ийг `"admin"` болгоно.

---

## Холбоосууд

- **Суулгах заавар** — `SETUP_GUIDE.md`
- **Ерөнхий README** — `README.md`
